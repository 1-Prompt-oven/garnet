"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6830],{398:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=r(5893),t=r(1151);const i={id:"how-to",sidebar_label:"How to Benchmark",title:"How to Benchmark"},l="Resp Benchmark tool",a={id:"benchmarking/how-to",title:"How to Benchmark",description:"Garnet project contains a Benchmark tool for running RESP benchmarking using different clients, different workloads and different strategies for measuring throughput, performance and latency.",source:"@site/docs/benchmarking/how-to.md",sourceDirName:"benchmarking",slug:"/benchmarking/how-to",permalink:"/docs/benchmarking/how-to",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/Garnet/tree/main/website/docs/benchmarking/how-to.md",tags:[],version:"current",frontMatter:{id:"how-to",sidebar_label:"How to Benchmark",title:"How to Benchmark"},sidebar:"garnetDocSidebar",previous:{title:"Objects",permalink:"/docs/extensions/objects"},next:{title:"Performance Numbers",permalink:"/docs/benchmarking/perf-numbers"}},o={},c=[{value:"Usage",id:"usage",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Raw strings commands",id:"raw-strings-commands",level:3},{value:"Bitmaps commands",id:"bitmaps-commands",level:3},{value:"Hyperloglog commands",id:"hyperloglog-commands",level:3},{value:"Sorted Sets &amp; Geo commands",id:"sorted-sets--geo-commands",level:3},{value:"Server commands",id:"server-commands",level:3},{value:"Type of benchmarks",id:"type-of-benchmarks",level:2},{value:"Online benchmarks",id:"online-benchmarks",level:3},{value:"Offline benchmarks",id:"offline-benchmarks",level:3},{value:"Running benchmarks in Cluster mode",id:"running-benchmarks-in-cluster-mode",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"resp-benchmark-tool",children:"Resp Benchmark tool"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Garnet"})," project contains a Benchmark tool for running RESP benchmarking using different clients, different workloads and different strategies for measuring throughput, performance and latency."]}),"\n",(0,s.jsx)(n.p,{children:"This tool exists under the folder:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"> Garnet\\benchmark\\Resp.benchmark\n"})}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"Below is the description of all the options available to configure the type and settings for the benchmarks."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-p, --port                  (Default: 3278) Port to connect to\r\n\r\n-h, --host                  (Default: 127.0.0.1) IP address to connect to\r\n\r\n--clientaddr                IP address of client (used when collecting metrics for dashboards).\r\n\r\n-s, --skipload              (Default: false) Skip loading phase\r\n\r\n--dbsize                    (Default: 1024) DB size\r\n\r\n--totalops                  (Default: 33554432) Total ops\r\n\r\n--op                        (Default: GET) Operation type (GET, MGET, INCR, PING, ZADDREM, PFADD)\r\n\r\n--keylength                 (Default: 1) Key length (bytes) - padded, 0 indicates pad to max DB size\r\n\r\n--valuelength               (Default: 8) Value length (bytes) - 0 indicates use key as value\r\n\r\n-b, --batchsize             (Default: 4096) Batch size, number of requests (comma separated)\r\n\r\n--runtime                   (Default: 15) Run time (seconds)\r\n\r\n-t, --threads               (Default: 1 2 4 8 16 32) Number of threads (comma separated)\r\n\r\n-a, --auth                  Authentication password\r\n\r\n--burst                     (Default: false) Wait for response or burst the system (GarnetClientSession)\r\n\r\n--cluster                   (Default: false) Cluster mode benchmark enable\r\n\r\n--shard                     (Default: -1) Restrict benchmark to specific shard\r\n\r\n--replica-reads             (Default: false) Allow replica reads for cluster mode.\r\n\r\n--lset                      (Default: false) Use set instead of mset to load data for benchmarking.\r\n\r\n--zipf                      (Default: false) Zipf data distribution (0.99)\r\n\r\n--client                    (Default: LightClient) Choose ClientType to run benchmark (LightClient, SERedis, GarnetClientSession)\r\n\r\n--pool                      (Default: false) Pool client instances. Supports SERedis, GarnetClient and GarnetClientSession (online bench only).\r\n\r\n--tls                       (Default: false) Enable TLS.\r\n\r\n--tlshost                   (Default: GarnetTest) TLS remote host name.\r\n\r\n-o, --online                (Default: false) Online get/set mix based on --readpercent.\r\n\r\n-x, --txn                   (Default: false) Transaction micro benchmark\r\n\r\n--itp                       (Default: 1) Intra-thread parallelism (online bench only).\r\n\r\n--sync                      (Default: false) Sync mode (online bench GarnetClient only).\r\n\r\n--ttl                       (Default: 0) Ttl for keys, required if --op is SETEX, or can be used to generate keys with expiration (both string and zset) in online\r\n                            benchmarks.\r\n\r\n--sscardinality             (Default: 0) Number of unique sorted sets. Same key will always go to the same sorted set.\r\n\r\n--client-hist               (Default: false) Enable client side latency tracking through internal client histogram.\r\n\r\n--op-percent                (Default: 60 30 10) Percent of commands executed from workload\r\n\r\n--op-workload               (Default: GET SET DEL) Workload of commands for online bench.\r\n\r\n--object-dbsize             (Default: -1) Object DB size\r\n\r\n--save-freq                 (Default: 0) Save (checkpoint) frequency in seconds\r\n\r\n--logger-level              (Default: Information) Logging level\r\n\r\n--disable-console-logger    (Default: false) Disable console logger.\r\n\r\n--file-logger               Enable file logger and write to the specified path.\r\n\r\n--enable-dashboard          (Default: false) Enable metrics recording for dashboards.\r\n\r\n--migrate-freq              (Default: 0) Used to control frequency of a task that issues migrate command (Only for cluster option).\r\n\r\n--migrate-batch             (Default: 100) Max number of slots picked to migrate from one node to another from background task that executes migrate (Only for\r\n                            cluster option).\r\n\r\n--help                      Display this help screen.\r\n\r\n--version                   Display version information.\n"})}),"\n",(0,s.jsx)(n.p,{children:"This output is sent to the console when running the benchmark tool using"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"--help"})}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"> cd Garnet\\benchmark\\Resp.benchmark\r\n> dotnet run -c Release --framework net8.0 -- --help\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,s.jsx)(n.p,{children:"The benchmark operates in two phases."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Load key in database"}),"\n",(0,s.jsx)(n.li,{children:"Run benchmark for a single command"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"In both phases ReqGen is used to generate the requests for either loading data\r\nor performing the benchmark."}),"\n",(0,s.jsx)(n.p,{children:"There are several options to generate requests as indicated by the constructor of the ReqGen class."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"        public ReqGen(\r\n            int Start,\r\n            int DbSize,\r\n            int NumOps,\r\n            int BatchSize,\r\n            OpType opType,\r\n            bool randomGen = true,\r\n            bool randomServe = true,\r\n            int keyLen = default,\r\n            int valueLen = default)\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Start: Key offset."}),"\n",(0,s.jsx)(n.li,{children:"DbSize: Number of keys in the database"}),"\n",(0,s.jsx)(n.li,{children:"NumOps: Total number of operations to be perfomed"}),"\n",(0,s.jsx)(n.li,{children:"BatchSize: Total number of ops in a batch."}),"\n",(0,s.jsx)(n.li,{children:"opType: Operation to be performed (e.g. GET, MSET, INCR)"}),"\n",(0,s.jsx)(n.li,{children:"randomGen: Whether to generate keys in sequence or randomly."}),"\n",(0,s.jsx)(n.li,{children:"randomServe: Whether serve the requests randomly or in the sequence they were generated."}),"\n",(0,s.jsx)(n.li,{children:"keyLen: The least number of bytes in a key. Keys are assigned from (Start,DbSize) range and padded accordingly to build a set of at least. The default size equals the maximum number of digits of DbSize."}),"\n",(0,s.jsx)(n.li,{children:"valueLen: The total number of bytes in a value."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The following method is used to load the data into the database"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"        public void LoadData(\r\n            int loadDbThreads = 8, \r\n            int BatchSize = 1 << 12, \r\n            int keyLen = default, \r\n            int valueLen = default)\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"loadDbThreads: Total number of threads used for loading"}),"\n",(0,s.jsx)(n.li,{children:"BatchSize: Total number of key-value pair in a batch"}),"\n",(0,s.jsx)(n.li,{children:"keyLen: length of a key in bytes."}),"\n",(0,s.jsx)(n.li,{children:"valueLen: length of a value in bytes."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The following method is used to run an iteration of the benchmark for a given operation with the specified parameters"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"        public void Run(\r\n            OpType opType,\r\n            int TotalOps,\r\n            int[] NumThreads,\r\n            int BatchSize = 1 << 12,\r\n            TimeSpan runTime = default,\r\n            bool randomGen = true,\r\n            bool randomServe = true,\r\n            int keyLen = default,\r\n            int valueLen = default)\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"opType: operation to benchmark"}),"\n",(0,s.jsx)(n.li,{children:"totalops: total ops executed for the given benchmark."}),"\n",(0,s.jsx)(n.li,{children:"NumThreads: Total number of clients used to run the benchmark"}),"\n",(0,s.jsx)(n.li,{children:"BatchSize: Total number of operations in a single batch."}),"\n",(0,s.jsx)(n.li,{children:"runTime: Minimum duration to run the benchmark."}),"\n",(0,s.jsx)(n.li,{children:"randomGen: The order in which keys are generated in the requests."}),"\n",(0,s.jsx)(n.li,{children:"randomServe: The order in which the request buffers are accessed."}),"\n",(0,s.jsx)(n.li,{children:"keyLen: least number of bytes in a single key."}),"\n",(0,s.jsx)(n.li,{children:"valueLen: total number of bytes in a value."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"commands"})," that can be benchmarked from each category are:"]}),"\n",(0,s.jsx)(n.h3,{id:"raw-strings-commands",children:"Raw strings commands"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SET"}),"\n",(0,s.jsx)(n.li,{children:"GET"}),"\n",(0,s.jsx)(n.li,{children:"MGET"}),"\n",(0,s.jsx)(n.li,{children:"INCR"}),"\n",(0,s.jsx)(n.li,{children:"SETEX"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"bitmaps-commands",children:"Bitmaps commands"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SETBIT"}),"\n",(0,s.jsx)(n.li,{children:"BITOP"}),"\n",(0,s.jsx)(n.li,{children:"GETBIT"}),"\n",(0,s.jsx)(n.li,{children:"BITCOUNT"}),"\n",(0,s.jsx)(n.li,{children:"BITPOS"}),"\n",(0,s.jsx)(n.li,{children:"BITOP_AND"}),"\n",(0,s.jsx)(n.li,{children:"BITOP_OR"}),"\n",(0,s.jsx)(n.li,{children:"BITOP_XOR"}),"\n",(0,s.jsx)(n.li,{children:"BITOP_NOT"}),"\n",(0,s.jsx)(n.li,{children:"BITFIELD_GET"}),"\n",(0,s.jsx)(n.li,{children:"BITFIELD_SET"}),"\n",(0,s.jsx)(n.li,{children:"BITFIELD_INCR"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"hyperloglog-commands",children:"Hyperloglog commands"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PFADD"}),"\n",(0,s.jsx)(n.li,{children:"PFCOUNT"}),"\n",(0,s.jsx)(n.li,{children:"PFMERGE"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"sorted-sets--geo-commands",children:"Sorted Sets & Geo commands"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ZADD"}),"\n",(0,s.jsx)(n.li,{children:"GEOADD"}),"\n",(0,s.jsx)(n.li,{children:"ZREM"}),"\n",(0,s.jsx)(n.li,{children:"ZCARD"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"server-commands",children:"Server commands"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PING"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"type-of-benchmarks",children:"Type of benchmarks"}),"\n",(0,s.jsx)(n.h3,{id:"online-benchmarks",children:"Online benchmarks"}),"\n",(0,s.jsx)(n.p,{children:"These options measure the average response time of the server:"}),"\n",(0,s.jsx)(n.p,{children:"From the folder:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Garnet/benchmark/Resp.benchmark\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'dotnet run -c Release --framework net8.0 -- --op-workload "GET, SET" --online -b 1 --op-percent "50, 50" -t 1\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'dotnet run -c Release --framework net8.0 -- --op-workload "GET, SET" --online -b 1 --op-percent "50, 50" -t 16 --client GarnetClientSession.\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'dotnet run -c Release --framework net8.0  -- --op-workload "ZADD, ZCARD" --online -b 1 --op-percent "50, 50" -t 1 --client SERedis --keylength 8\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Where:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--op-workload: the different commands to send."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--online: The type of the benchmark to do."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--op-percent: The weight of the load for each command."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--t or threads: The number of conexions the tool will create to send the load."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--client: The client to use. GarnetClientSession is good option to stress the system to its maximum. SERedis stands for Stack Exchange library."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--keylength: The length for the size of the key."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"offline-benchmarks",children:"Offline benchmarks"}),"\n",(0,s.jsx)(n.p,{children:"This category of benchmark use a Light Client to measure how many requests the server handles in a given period of time."}),"\n",(0,s.jsx)(n.p,{children:"Some examples of running offline benchmarks are:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet run -c Release --framework net8.0 -- --op GET -t 2,4,8,16 -b 512 --dbsize 10241024 --keylength 1024\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dotnet run -c Release --framework net8.0 -- --op ZADDCARD -t 64 --b 512 --dbsize 16777216 --keylength 512\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Where:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--op: the command to send. ZADDCARD will exercise the ZADD and ZCARD in the same run."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--t or threads: The number of threads to use."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"--dbsize: The amount of keys to create in the store"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"running-benchmarks-in-cluster-mode",children:"Running benchmarks in Cluster mode"})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>l});var s=r(7294);const t={},i=s.createContext(t);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);